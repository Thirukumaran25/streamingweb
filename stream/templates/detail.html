{% extends 'base.html' %}

{% block title %}{{ movie.title }} | Streaming Star{% endblock %}

{% block content %}
<style>
    .detail-vignette {
        background: linear-gradient(to top, #000 0%, transparent 100%),
                    linear-gradient(to right, #000 0%, rgba(0,0,0,0.4) 100%);
    }
</style>

<div class="bg-black text-white">

<div class="flex flex-col md:flex-row gap-8 items-start bg-black text-white p-6 md:p-12 font-sans">
    
    <div class="w-64 md:w-72 flex-shrink-0 shadow-2xl overflow-hidden">
        <img src="{{ movie.poster.url }}" alt="{{ movie.title }}" class="w-full h-auto object-cover">
    </div>

    <div class="flex-grow pt-2 md:pt-4">
        <h1 class="text-4xl md:text-5xl font-bold mb-1 tracking-tight">
            {{ movie.title }}
        </h1>

        {% if movie.director %}
        <p class="text-gray-400 text-sm mb-6">
            Director by <span class="text-white">{{ movie.director }}</span>
        </p>
        {% endif %}

        <div class="flex flex-wrap items-center gap-4 text-sm font-bold mb-8">
            {% if movie.year %}<span class="text-white">{{ movie.year }}</span>{% endif %}
            {% if movie.duration %}<span class="text-white">{{ movie.duration }}</span>{% endif %}
            {% if movie.genre %}<span class="text-white">{{ movie.genre }}</span>{% endif %}
            
            <div class="flex items-center gap-2">
                <span class="border border-gray-600 px-2 py-0.5 rounded text-[10px] text-gray-400">AD</span>
                <span class="text-white">4.9</span>
            </div>
        </div>

        <div class="flex flex-wrap items-center gap-6 mb-10">
            <a href="{% url 'play_movie' movie.id %}">
            <button class="bg-[#FFA629] hover:from-orange-500 hover:to-orange-600 text-black font-bold px-8 py-3 rounded-lg flex items-center gap-2 transition shadow-lg">
                <i class='bx bxs-right-arrow text-xl'></i> Watch Free
            </button>
            </a>
            
            <div class="flex items-center gap-5 text-2xl text-white/90">
                <button class="hover:text-white transition">
                    <i class='bx bx-check-circle'></i>
                </button>
                <form action="{% url 'toggle_my_list' movie.id %}" method="POST" class="inline">
                    {% csrf_token %}
                    <button type="submit" class="transition-all duration-300 transform active:scale-125 flex items-center group">
                        {% if is_in_list %}
                            <i class='bx bxs-bookmark text-red-600 text-2xl drop-shadow-[0_0_8px_rgba(220,38,38,0.4)]'></i>
                        {% else %}
                            <i class='bx bx-bookmark text-white group-hover:text-red-500 text-2xl'></i>
                        {% endif %}
                    </button>
                </form>
                <button class="hover:text-white transition">
                    <i class='bx bx-download'></i>
                </button>
            </div>
        </div>

        {% if movie.description %}
        <p class="text-gray-300 text-sm md:text-base leading-relaxed max-w-xl">
            {{ movie.description }}
        </p>
        {% endif %}
    </div>

</div>
    <div class="p-6">
        <div class="flex items-center gap-4 mb-10">
            <h2 class="text-xl font-black uppercase tracking-[0.3em]">Cast & Crew</h2>
            <div class="h-[1px] flex-grow bg-white/10"></div>
            <i class='bx bx-chevron-right text-2xl text-gray-600'></i>
        </div>

        <div class="flex flex-wrap gap-8 md:gap-14">
            {% for item in movie.moviecast_set.all %}
            <div class="group text-center w-28 md:w-36">
                <div class="aspect-square rounded-full overflow-hidden mb-4 border-2 border-transparent group-hover:border-yellow-500/50 transition duration-500 grayscale group-hover:grayscale-0">
                    <img src="{{ item.cast.image.url }}" alt="{{ item.cast.real_name }}" class="w-full h-full object-cover">
                </div>
                <h3 class="text-[10px] md:text-xs font-black uppercase tracking-tighter text-white mb-1 truncate">
                    {{ item.cast.real_name }}
                </h3>
                {% if item.character_name %}
                <p class="text-[9px] md:text-[10px] font-bold text-zinc-500 uppercase truncate">
                    {{ item.character_name }}
                </p>
                {% endif %}
            </div>
            {% empty %}
                <p class="text-zinc-600 text-xs font-bold uppercase tracking-widest italic">Cast information not available.</p>
            {% endfor %}
        </div>
    </div>
</div>


<div class="p-6 mt-10">
        <div class="flex items-center gap-4 mb-10">
            <h2 class="text-xl font-black uppercase tracking-[0.3em]">More Like This</h2>
            <div class="h-[1px] flex-grow bg-white/10"></div>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6">
            {% for sim_movie in similar_movies %}
            <a href="{% url 'movie_detail' sim_movie.id %}" class="group block">
                <div class="relative aspect-[2/3] overflow-hidden rounded-lg mb-3">
                    <img src="{{ sim_movie.poster.url }}" alt="{{ sim_movie.title }}" 
                         class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <i class='bx bx-play-circle text-4xl text-[#FFA629]'></i>
                    </div>
                </div>
                <h3 class="text-[10px] md:text-xs font-bold uppercase tracking-widest text-white truncate">
                    {{ sim_movie.title }}
                </h3>
                <p class="text-[9px] text-zinc-500 font-bold uppercase">{{ sim_movie.year }}</p>
            </a>
            {% empty %}
                <p class="text-zinc-600 text-xs font-bold uppercase tracking-widest italic">No similar titles found.</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}