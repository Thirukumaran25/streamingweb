<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Streaming Star{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Outfit:wght@100..900&display=swap" rel="stylesheet">

    <style>
        *{  margin: 0;
            padding:0;
            box_sizing: border-box;
            font-family: Inter, Roboto, sans-serif;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

<div id="searchOverlay" class="fixed inset-0 z-[100] search-glass hidden flex-col items-center pt-24 px-6">
    <button id="closeSearch" class="absolute top-8 right-8 text-white text-4xl hover:text-yellow-400 transition">
        <i class='bx bx-x'></i>
    </button>

    <div class="w-full max-w-4xl">
        <div class="relative flex items-center border-b-2 border-white/20 focus-within:border-yellow-400 transition-colors">
            <i class='bx bx-search text-3xl text-gray-400 mr-4'></i>
            <input type="text" id="searchInput" autocomplete="off"
                   placeholder="SEARCH TITLES, GENRES, OR ACTORS..." 
                   class="w-full bg-transparent py-6 text-4xl md:text-5xl font-black text-white outline-none uppercase tracking-tighter italic">
        </div>

        <div id="suggestionBox" class="w-full flex flex-wrap gap-3 mt-8"></div>

        <div id="searchResults" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6 mt-12 overflow-y-auto max-h-[65vh] no-scrollbar pb-10">
        </div>
    </div>
</div>

<div id="mobileMenu" class="fixed inset-0 bg-black/95 z-[60] hidden flex-col pt-24 px-6 transition-all duration-300">
    <button onclick="toggleMobileMenu()" class="absolute top-6 right-6 text-3xl text-white hover:text-yellow-400 transition">
        <i class='bx bx-x'></i>
    </button>
    
    <nav class="flex flex-col gap-6 text-lg font-bold uppercase tracking-widest">
        <a href="/" onclick="toggleMobileMenu()" class="hover:text-yellow-400 transition py-2 border-b border-white/10">Home</a>
        <a href="/movies/" onclick="toggleMobileMenu()" class="hover:text-yellow-400 transition py-2 border-b border-white/10">Movies</a>
        <a href="/tv-shows/" onclick="toggleMobileMenu()" class="hover:text-yellow-400 transition py-2 border-b border-white/10">TV Shows</a>
        <a href="/my-list/" onclick="toggleMobileMenu()" class="hover:text-yellow-400 transition py-2 border-b border-white/10">My List</a>
        <a href="/genres/" onclick="toggleMobileMenu()" class="hover:text-yellow-400 transition py-2 border-b border-white/10">Genres</a>
        
        {% if user.is_authenticated %}
        <div class="border-t border-white/20 pt-6 mt-4 space-y-4">
            <a href="/profile/" onclick="toggleMobileMenu()" class="flex items-center gap-3 hover:text-yellow-400 transition">
                <i class='bx bx-user text-xl'></i> Profile
            </a>
            <a href="/subscription/" onclick="toggleMobileMenu()" class="flex items-center gap-3 hover:text-yellow-400 transition">
                <i class='bx bx-credit-card text-xl'></i> Subscription
            </a>
            <a href="{% url 'logout' %}" class="flex items-center gap-3 text-red-400 hover:text-red-300 transition">
                <i class='bx bx-log-out text-xl'></i> Logout
            </a>
        </div>
        {% else %}
        <div class="border-t border-white/20 pt-6 mt-4 flex flex-col gap-4">
            <a href="{% url 'login' %}" onclick="toggleMobileMenu()" class="text-center border border-white/30 py-3 rounded hover:bg-white/10 transition">Login</a>
            <a href="{% url 'register' %}" onclick="toggleMobileMenu()" class="bg-yellow-400 text-black text-center py-3 rounded font-bold hover:bg-yellow-300 transition">Sign Up</a>
        </div>
        {% endif %}
    </nav>
</div>

<header class="w-full border-b border-white/10 px-6 md:px-16 py-4 flex items-center justify-between sticky top-0 bg-black z-50">

  <div class="flex items-center gap-8">
    <a href="/" class="flex items-center gap-2 text-yellow-400 font-bold text-lg tracking-tighter italic">
      <i class='bx bxs-star'></i>
      STREAMINGSTAR
    </a>

    <nav class="hidden md:flex gap-8 text-[11px] text-gray-300 font-black uppercase tracking-widest">
      <a href="/" class="hover:text-white transition">Home</a>
      <a href="/movies/" class="hover:text-white transition">Movies</a>
      <a href="/tv-shows/" class="hover:text-white transition">TV Shows</a>
      <a href="/my-list/" class="hover:text-white transition">My List</a>
      <a href="/genres/" class="hover:text-white transition">Genres</a>
    </nav>
  </div>

  <div class="flex items-center gap-3">

    <button id="openSearch" class="text-2xl text-white hover:text-yellow-400 transition p-2 rounded-lg hover:bg-white/5">
        <i class='bx bx-search'></i>
    </button>

    {% if user.is_authenticated %}
      <div class="relative" id="profileDropdown">
        <button onclick="toggleProfileMenu()" class="flex items-center gap-2 focus:outline-none p-1 rounded-lg hover:bg-white/5 transition">
          <div class="w-8 h-8 rounded bg-yellow-400 text-black flex items-center justify-center font-bold uppercase text-xs">
            {{ user.username|slice:":1" }}
          </div>
          <i class='bx bx-chevron-down text-gray-400'></i>
        </button>

        <div id="profileMenu" class="absolute right-0 mt-3 w-56 bg-zinc-900 border border-white/10 rounded-xl shadow-2xl hidden overflow-hidden dropdown-enter">
          <div class="px-4 py-3 border-b border-white/10 bg-zinc-800/50">
            <p class="text-sm font-bold text-white uppercase">{{ user.username }}</p>
            <p class="text-xs text-gray-400 truncate">{{ user.email }}</p>
          </div>
          
          <div class="py-2">
            <a href="/profile/" class="flex items-center gap-3 px-4 py-3 text-xs font-bold hover:bg-zinc-800 transition">
              <i class='bx bx-user text-gray-400 text-lg'></i> 
              <span>PROFILE</span>
            </a>
            <a href="/subscription/" class="flex items-center gap-3 px-4 py-3 text-xs font-bold hover:bg-zinc-800 transition">
              <i class='bx bx-credit-card text-gray-400 text-lg'></i> 
              <span>SUBSCRIPTION</span>
            </a>
          </div>
          
          <div class="border-t border-white/10 pt-2 pb-2">
            <a href="{% url 'logout' %}" class="flex items-center gap-3 px-4 py-3 text-xs font-bold text-red-400 hover:bg-zinc-800 transition">
              <i class='bx bx-log-out text-lg'></i> 
              <span>LOGOUT</span>
            </a>
          </div>
        </div>
      </div>
    {% else %}
      <a href="{% url 'login' %}" class="hidden sm:inline text-xs font-bold uppercase text-gray-300 hover:text-white tracking-widest mr-2">Login</a>
      <a href="{% url 'register' %}" class="bg-yellow-400 text-black px-5 py-2 rounded font-black text-xs uppercase tracking-widest hover:bg-yellow-300 transition">Sign Up</a>
    {% endif %}

    <button id="menuBtn" onclick="toggleMobileMenu()" class="md:hidden text-2xl text-white hover:text-yellow-400 transition p-2 rounded-lg hover:bg-white/5">
      <i class='bx bx-menu'></i>
    </button>
  </div>
</header>

<main class="flex-grow">
  {% block content %}{% endblock %}
</main>

<footer class="px-6 md:px-16 py-20 border-t border-white/5 bg-black">

    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-10 text-[11px] text-gray-400 uppercase font-bold tracking-widest">

        <div>
            <h4 class="text-white mb-6 font-black">Company</h4>
            <ul class="space-y-3">
                <li class="hover:text-white cursor-pointer transition">About</li>
                <li class="hover:text-white cursor-pointer transition">Career</li>
                <li class="hover:text-white cursor-pointer transition">Our Culture</li>
                <li class="hover:text-white cursor-pointer transition">Giving</li>
                <li class="hover:text-white cursor-pointer transition">Press room</li>
                <li class="hover:text-white cursor-pointer transition">Partners</li>
                <li class="hover:text-white cursor-pointer transition">Gear</li>
                <li class="hover:text-white cursor-pointer transition">The Blog</li>
                <li class="hover:text-white cursor-pointer transition">Advertise us</li>
            </ul>
        </div>

        <div>
            <h4 class="text-white mb-6 font-black">Go Premium</h4>
            <ul class="space-y-3">
                <li class="hover:text-white cursor-pointer transition">Plans</li>
                <li class="hover:text-white cursor-pointer transition">SS Labs</li>
                <li class="hover:text-white cursor-pointer transition">Get perks</li>
            </ul>
        </div>

        <div>
            <h4 class="text-white mb-6 font-black">Downloads</h4>
            <ul class="space-y-3">
                <li class="hover:text-white cursor-pointer transition">SS Media</li>
                <li class="hover:text-white cursor-pointer transition">Server</li>
                <li class="hover:text-white cursor-pointer transition">SS photos</li>
                <li class="hover:text-white cursor-pointer transition">SS Dash</li>
                <li class="hover:text-white cursor-pointer transition">Where to watch</li>
            </ul>
        </div>

        <div>
            <h4 class="text-white mb-6 font-black">Support</h4>
            <ul class="space-y-3">
                <li class="hover:text-white cursor-pointer transition">Finding Help</li>
                <li class="hover:text-white cursor-pointer transition">Support Help</li>
                <li class="hover:text-white cursor-pointer transition">Community</li>
                <li class="hover:text-white cursor-pointer transition">Forums</li>
                <li class="hover:text-white cursor-pointer transition">Guidelines</li>
                <li class="hover:text-white cursor-pointer transition">Billing</li>
                <li class="hover:text-white cursor-pointer transition">Status</li>
                <li class="hover:text-white cursor-pointer transition">Bug Bounty</li>
                <li class="hover:text-white cursor-pointer transition">Get in touch</li>
            </ul>
        </div>

        <div>
            <h4 class="text-white mb-6 font-black">Watch Free</h4>
            <ul class="space-y-3">
                <li class="hover:text-white cursor-pointer transition">Discover on SS</li>
                <li class="hover:text-white cursor-pointer transition">TV Channel finder</li>
                <li class="hover:text-white cursor-pointer transition">What to watch</li>
                <li class="hover:text-white cursor-pointer transition">A24 collection</li>
                <li class="hover:text-white cursor-pointer transition">Movie database</li>
            </ul>
        </div>

        <div>
            <h4 class="text-white mb-6 font-black">Legal</h4>
            <ul class="space-y-3">
                <li class="hover:text-white cursor-pointer transition">About us</li>
                <li class="hover:text-white cursor-pointer transition">Culture</li>
                <li class="hover:text-white cursor-pointer transition">Blogs</li>
                <li class="hover:text-white cursor-pointer transition">Jobs</li>
                <li class="hover:text-white cursor-pointer transition">Terms & Privacy</li>
                <li class="hover:text-white cursor-pointer transition">Help & Support</li>
            </ul>
        </div>

    </div>

    <div class="mt-20 border-t border-white/10 pt-8 flex flex-col items-center gap-8 text-gray-500 text-[10px] uppercase font-bold tracking-widest">
        
        <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-center">
            <span>Copyright Â© 2026 Streaming Star</span>
            <span class="hover:text-white cursor-pointer transition">Privacy policy</span>
            <span class="hover:text-white cursor-pointer transition">Ad choices</span>
            <span class="hover:text-white cursor-pointer transition">Accessibility</span>
            <span class="hover:text-white cursor-pointer transition">Manage cookies</span>
        </div>

        <div class="flex gap-8 text-2xl">
            <i class='bx bxl-youtube hover:text-red-600 transition cursor-pointer'></i>
            <i class='bx bxl-yahoo hover:text-purple-600 transition cursor-pointer'></i>
            <i class='bx bxl-amazon hover:text-yellow-500 transition cursor-pointer'></i>
            <i class='bx bxl-tumblr hover:text-blue-800 transition cursor-pointer'></i>
            <i class='bx bxl-facebook-square hover:text-blue-600 transition cursor-pointer'></i>
            <i class='bx bxl-twitter hover:text-sky-400 transition cursor-pointer'></i>
        </div>

    </div>

</footer>

<script>
    // --- Profile Dropdown Functionality ---
    function toggleProfileMenu() {
        const menu = document.getElementById('profileMenu');
        menu.classList.toggle('hidden');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('profileDropdown');
        const menu = document.getElementById('profileMenu');
        
        if (dropdown && !dropdown.contains(event.target)) {
            menu.classList.add('hidden');
        }
    });

    // Close dropdown when pressing Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const menu = document.getElementById('profileMenu');
            const mobileMenu = document.getElementById('mobileMenu');
            const searchOverlay = document.getElementById('searchOverlay');
            
            if (menu) menu.classList.add('hidden');
            if (mobileMenu) mobileMenu.classList.add('hidden');
            if (searchOverlay && !searchOverlay.classList.contains('hidden')) {
                searchOverlay.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }
    });

    // --- Mobile Menu Toggle ---
    function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobileMenu');
        mobileMenu.classList.toggle('hidden');
        
        // Prevent body scroll when mobile menu is open
        if (!mobileMenu.classList.contains('hidden')) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = 'auto';
        }
    }

    // --- Search Logic ---
    const openSearch = document.getElementById('openSearch');
    const closeSearch = document.getElementById('closeSearch');
    const searchOverlay = document.getElementById('searchOverlay');
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const suggestionBox = document.getElementById('suggestionBox');
    let debounceTimer;

    openSearch.addEventListener('click', () => {
        searchOverlay.classList.remove('hidden');
        searchInput.focus();
        document.body.style.overflow = 'hidden';
    });

    closeSearch.addEventListener('click', () => {
        searchOverlay.classList.add('hidden');
        document.body.style.overflow = 'auto';
    });

    // Helper to click suggestion
    function fillSearch(text) {
        searchInput.value = text;
        searchInput.dispatchEvent(new Event('input'));
    }

    searchInput.addEventListener('input', (e) => {
        clearTimeout(debounceTimer);
        const query = e.target.value.trim();

        if (query.length > 1) {
            // 1. Fetch suggestions instantly
            fetch(`/api/suggestions/?q=${query}`)
                .then(res => res.json())
                .then(data => {
                    suggestionBox.innerHTML = data.suggestions.map(s => `
                        <button onclick="fillSearch('${s}')" class="bg-white/10 hover:bg-yellow-400 hover:text-black px-4 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition">
                            ${s}
                        </button>
                    `).join('');
                });

            // 2. Fetch full results with debounce
            debounceTimer = setTimeout(() => {
                fetch(`/api/search/?q=${query}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.results && data.results.length > 0) {
                            searchResults.innerHTML = data.results.map(movie => `
                                <a href="/movie/${movie.imdbID}" class="group">
                                    <div class="aspect-[2/3] rounded-lg overflow-hidden border border-white/10 group-hover:border-yellow-400 transition duration-500 bg-zinc-900">
                                        <img src="${movie.Poster}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700" onerror="this.src='https://via.placeholder.com/300x450?text=NO+POSTER'">
                                    </div>
                                    <p class="mt-3 text-[10px] font-black uppercase tracking-tighter text-zinc-400 group-hover:text-yellow-400 transition">
                                        ${movie.Title}
                                    </p>
                                </a>
                            `).join('');
                        } else {
                            searchResults.innerHTML = `<p class="col-span-full text-center text-zinc-500 uppercase font-black">No results found</p>`;
                        }
                    });
            }, 300);
        } else {
            suggestionBox.innerHTML = '';
            searchResults.innerHTML = '';
        }
    });

    // Close search when clicking outside
    searchOverlay.addEventListener('click', (e) => {
        if (e.target === searchOverlay) {
            searchOverlay.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }
    });

    // --- Keyboard Shortcuts ---
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + K to open search
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            searchOverlay.classList.remove('hidden');
            searchInput.focus();
            document.body.style.overflow = 'hidden';
        }
    });

    // --- Header Scroll Effect ---
    let lastScroll = 0;
    const header = document.querySelector('header');

    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
        
        if (currentScroll > 50) {
            header.classList.add('shadow-lg');
            header.classList.replace('bg-black', 'bg-black/95');
        } else {
            header.classList.remove('shadow-lg');
            header.classList.replace('bg-black/95', 'bg-black');
        }
        
        lastScroll = currentScroll;
    });
</script>

</body>
</html>